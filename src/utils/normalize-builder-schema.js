"use strict";
/**
 * @license
 * Copyright Google LLC All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.normalizeBrowserSchema = void 0;
const normalize_asset_patterns_1 = require("./normalize-asset-patterns");
const normalize_cache_1 = require("./normalize-cache");
const normalize_file_replacements_1 = require("./normalize-file-replacements");
const normalize_optimization_1 = require("./normalize-optimization");
const normalize_source_maps_1 = require("./normalize-source-maps");
const supported_browsers_1 = require("./supported-browsers");
function normalizeBrowserSchema(workspaceRoot, projectRoot, projectSourceRoot, options, metadata) {
    const normalizedSourceMapOptions = (0, normalize_source_maps_1.normalizeSourceMaps)(options.sourceMap || false);
    return {
        ...options,
        cache: (0, normalize_cache_1.normalizeCacheOptions)(metadata, workspaceRoot),
        assets: (0, normalize_asset_patterns_1.normalizeAssetPatterns)(options.assets || [], workspaceRoot, projectRoot, projectSourceRoot),
        fileReplacements: (0, normalize_file_replacements_1.normalizeFileReplacements)(options.fileReplacements || [], workspaceRoot),
        optimization: (0, normalize_optimization_1.normalizeOptimization)(options.optimization),
        sourceMap: normalizedSourceMapOptions,
        preserveSymlinks: options.preserveSymlinks === undefined
            ? process.execArgv.includes('--preserve-symlinks')
            : options.preserveSymlinks,
        statsJson: options.statsJson || false,
        budgets: options.budgets || [],
        scripts: options.scripts || [],
        styles: options.styles || [],
        stylePreprocessorOptions: {
            includePaths: (options.stylePreprocessorOptions && options.stylePreprocessorOptions.includePaths) || [],
        },
        // Using just `--poll` will result in a value of 0 which is very likely not the intention
        // A value of 0 is falsy and will disable polling rather then enable
        // 500 ms is a sensible default in this case
        poll: options.poll === 0 ? 500 : options.poll,
        supportedBrowsers: (0, supported_browsers_1.getSupportedBrowsers)(projectRoot),
    };
}
exports.normalizeBrowserSchema = normalizeBrowserSchema;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm9ybWFsaXplLWJ1aWxkZXItc2NoZW1hLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vcGFja2FnZXMvYW5ndWxhcl9kZXZraXQvYnVpbGRfYW5ndWxhci9zcmMvdXRpbHMvbm9ybWFsaXplLWJ1aWxkZXItc2NoZW1hLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7O0dBTUc7OztBQVNILHlFQUFvRTtBQUNwRSx1REFBMEQ7QUFDMUQsK0VBR3VDO0FBQ3ZDLHFFQUFnRztBQUNoRyxtRUFBOEQ7QUFDOUQsNkRBQTREO0FBYTVELFNBQWdCLHNCQUFzQixDQUNwQyxhQUFxQixFQUNyQixXQUFtQixFQUNuQixpQkFBcUMsRUFDckMsT0FBNkIsRUFDN0IsUUFBeUI7SUFFekIsTUFBTSwwQkFBMEIsR0FBRyxJQUFBLDJDQUFtQixFQUFDLE9BQU8sQ0FBQyxTQUFTLElBQUksS0FBSyxDQUFDLENBQUM7SUFFbkYsT0FBTztRQUNMLEdBQUcsT0FBTztRQUNWLEtBQUssRUFBRSxJQUFBLHVDQUFxQixFQUFDLFFBQVEsRUFBRSxhQUFhLENBQUM7UUFDckQsTUFBTSxFQUFFLElBQUEsaURBQXNCLEVBQzVCLE9BQU8sQ0FBQyxNQUFNLElBQUksRUFBRSxFQUNwQixhQUFhLEVBQ2IsV0FBVyxFQUNYLGlCQUFpQixDQUNsQjtRQUNELGdCQUFnQixFQUFFLElBQUEsdURBQXlCLEVBQUMsT0FBTyxDQUFDLGdCQUFnQixJQUFJLEVBQUUsRUFBRSxhQUFhLENBQUM7UUFDMUYsWUFBWSxFQUFFLElBQUEsOENBQXFCLEVBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQztRQUN6RCxTQUFTLEVBQUUsMEJBQTBCO1FBQ3JDLGdCQUFnQixFQUNkLE9BQU8sQ0FBQyxnQkFBZ0IsS0FBSyxTQUFTO1lBQ3BDLENBQUMsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxxQkFBcUIsQ0FBQztZQUNsRCxDQUFDLENBQUMsT0FBTyxDQUFDLGdCQUFnQjtRQUM5QixTQUFTLEVBQUUsT0FBTyxDQUFDLFNBQVMsSUFBSSxLQUFLO1FBQ3JDLE9BQU8sRUFBRSxPQUFPLENBQUMsT0FBTyxJQUFJLEVBQUU7UUFDOUIsT0FBTyxFQUFFLE9BQU8sQ0FBQyxPQUFPLElBQUksRUFBRTtRQUM5QixNQUFNLEVBQUUsT0FBTyxDQUFDLE1BQU0sSUFBSSxFQUFFO1FBQzVCLHdCQUF3QixFQUFFO1lBQ3hCLFlBQVksRUFDVixDQUFDLE9BQU8sQ0FBQyx3QkFBd0IsSUFBSSxPQUFPLENBQUMsd0JBQXdCLENBQUMsWUFBWSxDQUFDLElBQUksRUFBRTtTQUM1RjtRQUNELHlGQUF5RjtRQUN6RixvRUFBb0U7UUFDcEUsNENBQTRDO1FBQzVDLElBQUksRUFBRSxPQUFPLENBQUMsSUFBSSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSTtRQUM3QyxpQkFBaUIsRUFBRSxJQUFBLHlDQUFvQixFQUFDLFdBQVcsQ0FBQztLQUNyRCxDQUFDO0FBQ0osQ0FBQztBQXZDRCx3REF1Q0MiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgR29vZ2xlIExMQyBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICpcbiAqIFVzZSBvZiB0aGlzIHNvdXJjZSBjb2RlIGlzIGdvdmVybmVkIGJ5IGFuIE1JVC1zdHlsZSBsaWNlbnNlIHRoYXQgY2FuIGJlXG4gKiBmb3VuZCBpbiB0aGUgTElDRU5TRSBmaWxlIGF0IGh0dHBzOi8vYW5ndWxhci5pby9saWNlbnNlXG4gKi9cblxuaW1wb3J0IHsganNvbiB9IGZyb20gJ0Bhbmd1bGFyLWRldmtpdC9jb3JlJztcbmltcG9ydCB7XG4gIEFzc2V0UGF0dGVybkNsYXNzLFxuICBTY2hlbWEgYXMgQnJvd3NlckJ1aWxkZXJTY2hlbWEsXG4gIFNvdXJjZU1hcENsYXNzLFxufSBmcm9tICcuLi9idWlsZGVycy9icm93c2VyL3NjaGVtYSc7XG5pbXBvcnQgeyBCdWlsZE9wdGlvbnMgfSBmcm9tICcuL2J1aWxkLW9wdGlvbnMnO1xuaW1wb3J0IHsgbm9ybWFsaXplQXNzZXRQYXR0ZXJucyB9IGZyb20gJy4vbm9ybWFsaXplLWFzc2V0LXBhdHRlcm5zJztcbmltcG9ydCB7IG5vcm1hbGl6ZUNhY2hlT3B0aW9ucyB9IGZyb20gJy4vbm9ybWFsaXplLWNhY2hlJztcbmltcG9ydCB7XG4gIE5vcm1hbGl6ZWRGaWxlUmVwbGFjZW1lbnQsXG4gIG5vcm1hbGl6ZUZpbGVSZXBsYWNlbWVudHMsXG59IGZyb20gJy4vbm9ybWFsaXplLWZpbGUtcmVwbGFjZW1lbnRzJztcbmltcG9ydCB7IE5vcm1hbGl6ZWRPcHRpbWl6YXRpb25PcHRpb25zLCBub3JtYWxpemVPcHRpbWl6YXRpb24gfSBmcm9tICcuL25vcm1hbGl6ZS1vcHRpbWl6YXRpb24nO1xuaW1wb3J0IHsgbm9ybWFsaXplU291cmNlTWFwcyB9IGZyb20gJy4vbm9ybWFsaXplLXNvdXJjZS1tYXBzJztcbmltcG9ydCB7IGdldFN1cHBvcnRlZEJyb3dzZXJzIH0gZnJvbSAnLi9zdXBwb3J0ZWQtYnJvd3NlcnMnO1xuXG4vKipcbiAqIEEgbm9ybWFsaXplZCBicm93c2VyIGJ1aWxkZXIgc2NoZW1hLlxuICovXG5leHBvcnQgdHlwZSBOb3JtYWxpemVkQnJvd3NlckJ1aWxkZXJTY2hlbWEgPSBCcm93c2VyQnVpbGRlclNjaGVtYSAmXG4gIEJ1aWxkT3B0aW9ucyAmIHtcbiAgICBzb3VyY2VNYXA6IFNvdXJjZU1hcENsYXNzO1xuICAgIGFzc2V0czogQXNzZXRQYXR0ZXJuQ2xhc3NbXTtcbiAgICBmaWxlUmVwbGFjZW1lbnRzOiBOb3JtYWxpemVkRmlsZVJlcGxhY2VtZW50W107XG4gICAgb3B0aW1pemF0aW9uOiBOb3JtYWxpemVkT3B0aW1pemF0aW9uT3B0aW9ucztcbiAgfTtcblxuZXhwb3J0IGZ1bmN0aW9uIG5vcm1hbGl6ZUJyb3dzZXJTY2hlbWEoXG4gIHdvcmtzcGFjZVJvb3Q6IHN0cmluZyxcbiAgcHJvamVjdFJvb3Q6IHN0cmluZyxcbiAgcHJvamVjdFNvdXJjZVJvb3Q6IHN0cmluZyB8IHVuZGVmaW5lZCxcbiAgb3B0aW9uczogQnJvd3NlckJ1aWxkZXJTY2hlbWEsXG4gIG1ldGFkYXRhOiBqc29uLkpzb25PYmplY3QsXG4pOiBOb3JtYWxpemVkQnJvd3NlckJ1aWxkZXJTY2hlbWEge1xuICBjb25zdCBub3JtYWxpemVkU291cmNlTWFwT3B0aW9ucyA9IG5vcm1hbGl6ZVNvdXJjZU1hcHMob3B0aW9ucy5zb3VyY2VNYXAgfHwgZmFsc2UpO1xuXG4gIHJldHVybiB7XG4gICAgLi4ub3B0aW9ucyxcbiAgICBjYWNoZTogbm9ybWFsaXplQ2FjaGVPcHRpb25zKG1ldGFkYXRhLCB3b3Jrc3BhY2VSb290KSxcbiAgICBhc3NldHM6IG5vcm1hbGl6ZUFzc2V0UGF0dGVybnMoXG4gICAgICBvcHRpb25zLmFzc2V0cyB8fCBbXSxcbiAgICAgIHdvcmtzcGFjZVJvb3QsXG4gICAgICBwcm9qZWN0Um9vdCxcbiAgICAgIHByb2plY3RTb3VyY2VSb290LFxuICAgICksXG4gICAgZmlsZVJlcGxhY2VtZW50czogbm9ybWFsaXplRmlsZVJlcGxhY2VtZW50cyhvcHRpb25zLmZpbGVSZXBsYWNlbWVudHMgfHwgW10sIHdvcmtzcGFjZVJvb3QpLFxuICAgIG9wdGltaXphdGlvbjogbm9ybWFsaXplT3B0aW1pemF0aW9uKG9wdGlvbnMub3B0aW1pemF0aW9uKSxcbiAgICBzb3VyY2VNYXA6IG5vcm1hbGl6ZWRTb3VyY2VNYXBPcHRpb25zLFxuICAgIHByZXNlcnZlU3ltbGlua3M6XG4gICAgICBvcHRpb25zLnByZXNlcnZlU3ltbGlua3MgPT09IHVuZGVmaW5lZFxuICAgICAgICA/IHByb2Nlc3MuZXhlY0FyZ3YuaW5jbHVkZXMoJy0tcHJlc2VydmUtc3ltbGlua3MnKVxuICAgICAgICA6IG9wdGlvbnMucHJlc2VydmVTeW1saW5rcyxcbiAgICBzdGF0c0pzb246IG9wdGlvbnMuc3RhdHNKc29uIHx8IGZhbHNlLFxuICAgIGJ1ZGdldHM6IG9wdGlvbnMuYnVkZ2V0cyB8fCBbXSxcbiAgICBzY3JpcHRzOiBvcHRpb25zLnNjcmlwdHMgfHwgW10sXG4gICAgc3R5bGVzOiBvcHRpb25zLnN0eWxlcyB8fCBbXSxcbiAgICBzdHlsZVByZXByb2Nlc3Nvck9wdGlvbnM6IHtcbiAgICAgIGluY2x1ZGVQYXRoczpcbiAgICAgICAgKG9wdGlvbnMuc3R5bGVQcmVwcm9jZXNzb3JPcHRpb25zICYmIG9wdGlvbnMuc3R5bGVQcmVwcm9jZXNzb3JPcHRpb25zLmluY2x1ZGVQYXRocykgfHwgW10sXG4gICAgfSxcbiAgICAvLyBVc2luZyBqdXN0IGAtLXBvbGxgIHdpbGwgcmVzdWx0IGluIGEgdmFsdWUgb2YgMCB3aGljaCBpcyB2ZXJ5IGxpa2VseSBub3QgdGhlIGludGVudGlvblxuICAgIC8vIEEgdmFsdWUgb2YgMCBpcyBmYWxzeSBhbmQgd2lsbCBkaXNhYmxlIHBvbGxpbmcgcmF0aGVyIHRoZW4gZW5hYmxlXG4gICAgLy8gNTAwIG1zIGlzIGEgc2Vuc2libGUgZGVmYXVsdCBpbiB0aGlzIGNhc2VcbiAgICBwb2xsOiBvcHRpb25zLnBvbGwgPT09IDAgPyA1MDAgOiBvcHRpb25zLnBvbGwsXG4gICAgc3VwcG9ydGVkQnJvd3NlcnM6IGdldFN1cHBvcnRlZEJyb3dzZXJzKHByb2plY3RSb290KSxcbiAgfTtcbn1cbiJdfQ==