"use strict";
/**
 * @license
 * Copyright Google LLC All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.getSharedCompilationState = exports.SharedTSCompilationState = void 0;
class SharedTSCompilationState {
    #pendingCompilation = true;
    #resolveCompilationReady;
    #compilationReadyPromise;
    get waitUntilReady() {
        if (!this.#pendingCompilation) {
            return Promise.resolve();
        }
        this.#compilationReadyPromise ??= new Promise((resolve) => {
            this.#resolveCompilationReady = resolve;
        });
        return this.#compilationReadyPromise;
    }
    markAsReady() {
        this.#resolveCompilationReady?.();
        this.#compilationReadyPromise = undefined;
        this.#pendingCompilation = false;
    }
    markAsInProgress() {
        this.#pendingCompilation = true;
    }
    dispose() {
        this.markAsReady();
        globalSharedCompilationState = undefined;
    }
}
exports.SharedTSCompilationState = SharedTSCompilationState;
let globalSharedCompilationState;
function getSharedCompilationState() {
    return (globalSharedCompilationState ??= new SharedTSCompilationState());
}
exports.getSharedCompilationState = getSharedCompilationState;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcGlsYXRpb24tc3RhdGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9wYWNrYWdlcy9hbmd1bGFyX2RldmtpdC9idWlsZF9hbmd1bGFyL3NyYy90b29scy9lc2J1aWxkL2FuZ3VsYXIvY29tcGlsYXRpb24tc3RhdGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7R0FNRzs7O0FBRUgsTUFBYSx3QkFBd0I7SUFDbkMsbUJBQW1CLEdBQUcsSUFBSSxDQUFDO0lBQzNCLHdCQUF3QixDQUEyQjtJQUNuRCx3QkFBd0IsQ0FBNEI7SUFFcEQsSUFBSSxjQUFjO1FBQ2hCLElBQUksQ0FBQyxJQUFJLENBQUMsbUJBQW1CLEVBQUU7WUFDN0IsT0FBTyxPQUFPLENBQUMsT0FBTyxFQUFFLENBQUM7U0FDMUI7UUFFRCxJQUFJLENBQUMsd0JBQXdCLEtBQUssSUFBSSxPQUFPLENBQUMsQ0FBQyxPQUFPLEVBQUUsRUFBRTtZQUN4RCxJQUFJLENBQUMsd0JBQXdCLEdBQUcsT0FBTyxDQUFDO1FBQzFDLENBQUMsQ0FBQyxDQUFDO1FBRUgsT0FBTyxJQUFJLENBQUMsd0JBQXdCLENBQUM7SUFDdkMsQ0FBQztJQUVELFdBQVc7UUFDVCxJQUFJLENBQUMsd0JBQXdCLEVBQUUsRUFBRSxDQUFDO1FBQ2xDLElBQUksQ0FBQyx3QkFBd0IsR0FBRyxTQUFTLENBQUM7UUFDMUMsSUFBSSxDQUFDLG1CQUFtQixHQUFHLEtBQUssQ0FBQztJQUNuQyxDQUFDO0lBRUQsZ0JBQWdCO1FBQ2QsSUFBSSxDQUFDLG1CQUFtQixHQUFHLElBQUksQ0FBQztJQUNsQyxDQUFDO0lBRUQsT0FBTztRQUNMLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNuQiw0QkFBNEIsR0FBRyxTQUFTLENBQUM7SUFDM0MsQ0FBQztDQUNGO0FBL0JELDREQStCQztBQUVELElBQUksNEJBQWtFLENBQUM7QUFFdkUsU0FBZ0IseUJBQXlCO0lBQ3ZDLE9BQU8sQ0FBQyw0QkFBNEIsS0FBSyxJQUFJLHdCQUF3QixFQUFFLENBQUMsQ0FBQztBQUMzRSxDQUFDO0FBRkQsOERBRUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgR29vZ2xlIExMQyBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICpcbiAqIFVzZSBvZiB0aGlzIHNvdXJjZSBjb2RlIGlzIGdvdmVybmVkIGJ5IGFuIE1JVC1zdHlsZSBsaWNlbnNlIHRoYXQgY2FuIGJlXG4gKiBmb3VuZCBpbiB0aGUgTElDRU5TRSBmaWxlIGF0IGh0dHBzOi8vYW5ndWxhci5pby9saWNlbnNlXG4gKi9cblxuZXhwb3J0IGNsYXNzIFNoYXJlZFRTQ29tcGlsYXRpb25TdGF0ZSB7XG4gICNwZW5kaW5nQ29tcGlsYXRpb24gPSB0cnVlO1xuICAjcmVzb2x2ZUNvbXBpbGF0aW9uUmVhZHk6ICgoKSA9PiB2b2lkKSB8IHVuZGVmaW5lZDtcbiAgI2NvbXBpbGF0aW9uUmVhZHlQcm9taXNlOiBQcm9taXNlPHZvaWQ+IHwgdW5kZWZpbmVkO1xuXG4gIGdldCB3YWl0VW50aWxSZWFkeSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAoIXRoaXMuI3BlbmRpbmdDb21waWxhdGlvbikge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cblxuICAgIHRoaXMuI2NvbXBpbGF0aW9uUmVhZHlQcm9taXNlID8/PSBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgdGhpcy4jcmVzb2x2ZUNvbXBpbGF0aW9uUmVhZHkgPSByZXNvbHZlO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHRoaXMuI2NvbXBpbGF0aW9uUmVhZHlQcm9taXNlO1xuICB9XG5cbiAgbWFya0FzUmVhZHkoKTogdm9pZCB7XG4gICAgdGhpcy4jcmVzb2x2ZUNvbXBpbGF0aW9uUmVhZHk/LigpO1xuICAgIHRoaXMuI2NvbXBpbGF0aW9uUmVhZHlQcm9taXNlID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuI3BlbmRpbmdDb21waWxhdGlvbiA9IGZhbHNlO1xuICB9XG5cbiAgbWFya0FzSW5Qcm9ncmVzcygpOiB2b2lkIHtcbiAgICB0aGlzLiNwZW5kaW5nQ29tcGlsYXRpb24gPSB0cnVlO1xuICB9XG5cbiAgZGlzcG9zZSgpOiB2b2lkIHtcbiAgICB0aGlzLm1hcmtBc1JlYWR5KCk7XG4gICAgZ2xvYmFsU2hhcmVkQ29tcGlsYXRpb25TdGF0ZSA9IHVuZGVmaW5lZDtcbiAgfVxufVxuXG5sZXQgZ2xvYmFsU2hhcmVkQ29tcGlsYXRpb25TdGF0ZTogU2hhcmVkVFNDb21waWxhdGlvblN0YXRlIHwgdW5kZWZpbmVkO1xuXG5leHBvcnQgZnVuY3Rpb24gZ2V0U2hhcmVkQ29tcGlsYXRpb25TdGF0ZSgpOiBTaGFyZWRUU0NvbXBpbGF0aW9uU3RhdGUge1xuICByZXR1cm4gKGdsb2JhbFNoYXJlZENvbXBpbGF0aW9uU3RhdGUgPz89IG5ldyBTaGFyZWRUU0NvbXBpbGF0aW9uU3RhdGUoKSk7XG59XG4iXX0=